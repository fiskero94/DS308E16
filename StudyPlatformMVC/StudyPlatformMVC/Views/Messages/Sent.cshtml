@using StudyPlatformMVC.Models
@model StudyPlatformMVC.ViewModels.MessageViewModel
@Styles.Render("~/Content/messages")
@{
    ViewBag.Title = "Udbakke";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{ // Variables
    string tableSize = "col-md-5 col-xs-5";
    if (Model.CurrentMessage == null)
    {
        tableSize = "col-md-12 col-xs-12";
    }
}
@if (Model.Messages.Count == 0)
{
    <p>Du har ikke sendt nogen beskeder</p>
    <br /><br />
    <a href="#" class="btn btn-default">Ny besked</a>
    <br /><br />
}
else
{
    <div class="container @tableSize">
        <div class="form-group pull-left">
            <a href="#" class="btn btn-default">Ny besked</a>
            <input type="text" class="search form-control" placeholder="Hvad leder du efter?">
        </div>
        <span class="counter pull-right"></span>
        <table class="table table-striped table-hover results" data-search="true">
            <thead>
            <tr>
                <th class="col-md-2 col-xs-2">Titel</th>
                <th class="col-md-2 col-xs-2">Modtagere</th>
                <th class="col-md-1 col-xs-1">Dato</th>
            </tr>
                <tr class="warning no-result">
                    <td colspan="4"><i class="fa fa-warning"></i> No result</td>
                </tr>
            </thead>
            <tbody data-link="row" class="rowlink">
                @foreach (Message message in Model.Messages)
                {
                    @AddMessage(message)
                }
            </tbody>
        </table>
    </div>
}
@if (Model.CurrentMessage != null)
{
    <div class="container col-md-7 col-xs-7">
        <div class="jumbotron" style="padding: 32px;">
            @Model.CurrentMessage.Title
            <blockquote>
                @Model.CurrentMessage.Text
                <small>
                    <i>fra</i> @Model.CurrentMessage.Sender.Name <i>til</i> @AddRecipients(Model.CurrentMessage)
                    <br /><i>@Model.CurrentMessage.DateTimeSent</i>
                </small>
            </blockquote>
            <div class="container text-right">
                <a href="#" class="btn btn-default">Svar</a>
                <a href="#" class="btn btn-default">Videresend</a>
            </div>
        </div>
    </div>
}
@helper AddMessage(Message message)
{
    <tr>
        <td><a href="/Messages/Sent/@message.ID"></a>@message.Title</td>
        <td>@AddRecipients(message)</td>
        <td>@message.DateTimeSent</td>
    </tr>
}
@helper AddRecipients(Message message)
{
string recipients = "";
foreach (Person recipient in message.Recipients)
{
    recipients += recipient.Name;
    recipients += ", ";
}
recipients = recipients.TrimEnd(' ');
recipients = recipients.TrimEnd(',');
    @Html.Label(recipients, new { style="display:inline;" })
}